<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NBA Info Hub</title>
<style>
body { font-family: Arial, sans-serif; background:#121212; color:#fff; margin:0; padding:20px; }
h1,h2 { text-align:center; color:#ff69b4; margin-bottom:15px; }
#search { display:block; margin:0 auto 30px auto; padding:10px; width:300px; border-radius:5px; border:none; }
.grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:15px; margin-bottom:30px; }
.card { background:#00ffff20; border-radius:15px; padding:15px; display:flex; flex-direction:column; justify-content:space-between; transition:transform 0.2s; cursor:pointer; }
.card:hover { transform:scale(1.05); background:#00ffff40; }
.top-card { background:#ff69b420; font-weight:bold; padding:15px; border-radius:15px; text-align:center; cursor:default; }
.card span { margin:5px 0; }
.section { margin-bottom:40px; }
.sortable-header { cursor:pointer; text-decoration:underline; }
#modal { position:fixed; top:10%; left:50%; transform:translateX(-50%); background:#121212; border:2px solid #ff69b4; border-radius:15px; padding:20px; z-index:1000; max-width:600px; max-height:80%; overflow-y:auto; display:none; }
#modal h3 { text-align:center; color:#ff69b4; margin-bottom:10px; }
#close-modal { cursor:pointer; color:#ff69b4; text-align:right; font-weight:bold; margin-bottom:10px; }
.table-header { font-weight:bold; display:flex; justify-content:space-between; margin-bottom:5px; cursor:pointer; }
.table-row { display:flex; justify-content:space-between; margin-bottom:3px; }
</style>
</head>
<body>

<h1>NBA Info Hub</h1>
<input type="text" id="search" placeholder="Search players, teams, or positions">

<div class="section">
  <h2>Top Performers</h2>
  <div id="top-performers" class="grid"></div>
</div>

<div class="section">
  <h2>Recent Games</h2>
  <div id="games" class="grid"></div>
</div>

<div class="section">
  <h2>All Players</h2>
  <div id="players" class="grid"></div>
</div>

<div class="section">
  <h2>Teams</h2>
  <div id="teams" class="grid"></div>
</div>

<div class="section">
  <h2>Standings <span class="sortable-header" id="sort-standings">Sort by Wins</span></h2>
  <div id="standings" class="grid"></div>
</div>

<div class="section">
  <h2>NBA News</h2>
  <div id="news" class="grid"></div>
</div>

<!-- Modal -->
<div id="modal">
  <div id="close-modal">Close âœ–</div>
  <h3 id="modal-title"></h3>
  <div id="modal-content"></div>
</div>

<script>
let allPlayers=[], allTeams={}, standingsSorted=false, allGames=[];

// Fetch players
async function fetchPlayers(){
  const res=await fetch('https://api.sleeper.app/v1/players/nba');
  const data=await res.json();
  allPlayers=Object.values(data).filter(p=>p.first_name&&p.last_name).sort((a,b)=>a.last_name.localeCompare(b.last_name));
  displayPlayers(allPlayers);
}

// Display players
function displayPlayers(players){
  const container=document.getElementById('players');
  container.innerHTML='';
  players.forEach(p=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<span><strong>${p.first_name} ${p.last_name}</strong></span>
                   <span>Team: ${p.team||"N/A"}</span>
                   <span>Position: ${p.position||"N/A"}</span>`;

    const playerTeam = p.team;
    // Find an active or recent game for the player's team
    const game = playerTeam ? allGames.find(g => (g.home_team === playerTeam || g.away_team === playerTeam) && g.status.toLowerCase() !== 'scheduled') : null;

    if (game) {
        // If a game is found, make the card clickable to view the stat card
        div.addEventListener('click', () => {
            const today = new Date().toISOString().split('T')[0]; // Assume game is today
            const playerName = `${p.first_name} ${p.last_name}`;
            window.location.href = `stat-card.html?playerName=${encodeURIComponent(playerName)}&date=${today}`;
        });
    } else {
        // If no game, make the card non-interactive
        div.style.opacity = '0.6';
        div.style.cursor = 'default';
    }
    container.appendChild(div);
  });
}

// Search players
document.getElementById('search').addEventListener('input', e=>{
  const q=e.target.value.toLowerCase();
  displayPlayers(allPlayers.filter(p=>`${p.first_name} ${p.last_name}`.toLowerCase().includes(q)||
    (p.team&&p.team.toLowerCase().includes(q))||(p.position&&p.position.toLowerCase().includes(q))));
});

// Top performers
async function displayTopPerformers(){
  const res=await fetch('https://api.sleeper.app/v1/stats/nba/2025/1');
  const stats=await res.json();
  const container=document.getElementById('top-performers');
  const topPlayers=stats.filter(s=>s.pts).sort((a,b)=>b.pts-a.pts).slice(0,5);
  container.innerHTML='';
  topPlayers.forEach(stat=>{
    const player=allPlayers.find(p=>p.player_id===stat.player_id);
    if(!player) return;
    const div=document.createElement('div');
    div.className='top-card';
    div.innerHTML=`<span>${player.first_name} ${player.last_name}</span>
                   <span>${player.team}</span>
                   <span>${stat.pts} pts | ${stat.reb} reb | ${stat.ast} ast</span>`;
    container.appendChild(div);
  });
}

// Fetch games
async function fetchGames(){
  const res=await fetch('https://api.sleeper.app/v1/state/nba');
  const data=await res.json();
  allGames=data.nba_games;
  const container=document.getElementById('games');
  container.innerHTML='';
  allGames.slice(-6).forEach(game=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<span>${game.home_team} ${game.home_score}</span>
                   <span>${game.away_team} ${game.away_score}</span>
                   <span>Status: ${game.status}</span>`;
    div.addEventListener('click',()=>showGameDetails(game));
    container.appendChild(div);
  });
}

// Fetch teams
async function fetchTeams(){
  const res=await fetch('https://api.sleeper.app/v1/teams/nba');
  const teams=await res.json();
  allTeams=teams;
  const container=document.getElementById('teams');
  container.innerHTML='';
  Object.values(teams).forEach(team=>{
    const div=document.createElement('div');
    div.className='card';
    div.innerHTML=`<span>${team.full_name} (${team.abbr})</span>
                   <span>Conf: ${team.conference} | Div: ${team.division}</span>`;
    container.appendChild(div);
  });
  displayStandings();
}

// Standings
function displayStandings(){
  const container=document.getElementById('standings');
  container.innerHTML='';
  let teamsArray=Object.values(allTeams);
  if(standingsSorted) teamsArray.sort((a,b)=>(b.wins||0)-(a.wins||0));
  teamsArray.forEach(team=>{
    const div=document.createElement('div');
    div.className='card';
    div.textContent=`${team.full_name} | ${team.wins||0}-${team.losses||0}`;
    container.appendChild(div);
  });
}

// Toggle standings sort
document.getElementById('sort-standings').addEventListener('click', ()=>{
  standingsSorted=!standingsSorted;
  displayStandings();
});

// Fetch news (replace YOUR_NEWSAPI_KEY)
async function fetchNews(){
  try{
    const res=await fetch('https://newsapi.org/v2/top-headlines?category=sports&q=NBA&apiKey=YOUR_NEWSAPI_KEY&pageSize=6');
    const data=await res.json();
    const container=document.getElementById('news');
    container.innerHTML='';
    data.articles.forEach(article=>{
      const div=document.createElement('div');
      div.className='card';
      div.innerHTML=`<span><strong>${article.title}</strong></span>
                     <span>${article.source.name}</span>
                     <a href="${article.url}" target="_blank" style="color:#ff69b4;">Read</a>`;
      container.appendChild(div);
    });
  }catch(err){ console.error(err);}
}

// Show game details modal
async function showGameDetails(game){
  const modal=document.getElementById('modal');
  const title=document.getElementById('modal-title');
  const content=document.getElementById('modal-content');
  title.textContent=`${game.away_team} @ ${game.home_team}`;
  content.innerHTML='Loading player stats...';
  try{
    const res=await fetch('https://api.sleeper.app/v1/stats/nba/2025/1');
    const stats=await res.json();
    const playersInGame=stats.filter(s=>s.team===game.home_team||s.team===game.away_team);
    if(playersInGame.length===0){ content.innerHTML='<span>No stats available.</span>'; }
    else{
      content.innerHTML='';
      const header=document.createElement('div');
      header.className='table-header';
      header.innerHTML='<span>Player</span><span>PTS</span><span>REB</span><span>AST</span>';
      content.appendChild(header);
      playersInGame.forEach(s=>{
        const player=allPlayers.find(p=>p.player_id===s.player_id);
        if(!player) return;
        const row=document.createElement('div');
        row.className='table-row';
        row.innerHTML=`<span>${player.first_name} ${player.last_name}</span><span>${s.pts||0}</span><span>${s.reb||0}</span><span>${s.ast||0}</span>`;
        content.appendChild(row);
      });
    }
    modal.style.display='block';
  }catch(err){ content.innerHTML='Error loading stats'; console.error(err);}
}

// Close modal
document.getElementById('close-modal').addEventListener('click', ()=>{ document.getElementById('modal').style.display='none'; });

// Initialize
async function init() {
    await fetchGames(); // Ensures allGames is populated first
    await fetchPlayers(); // Now has access to allGames
    displayTopPerformers();
    fetchTeams();
    fetchNews();
}
init();
</script>
</body>
</html>
